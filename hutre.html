<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Planificateur d'activités avec timeline</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f0f4f8;
    color: #222;
  }
  h1 {
    text-align: center;
    color: #0078d4;
  }
  form {
    max-width: 700px;
    margin: auto;
    padding: 1rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
  }
  label {
    display: flex;
    flex-direction: column;
    font-weight: 600;
    min-width: 150px;
  }
  select, input[type=number] {
    margin-top: 0.3rem;
    padding: 0.4rem;
    font-size: 1rem;
  }
  button {
    padding: 0.6rem 1.4rem;
    font-weight: 700;
    background-color: #0078d4;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    align-self: flex-end;
  }
  button:hover {
    background-color: #005a9e;
  }

  #timeline-container {
    margin: 2rem auto;
    max-width: 900px;
    background: white;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow-x: auto;
  }
  #timeline {
    position: relative;
    height: 100px;
    border-top: 3px solid #0078d4;
    border-bottom: 3px solid #0078d4;
    display: flex;
    gap: 1px;
  }
  .hour-block {
    flex: 1;
    text-align: center;
    font-weight: 700;
    font-size: 0.9rem;
    color: #555;
    border-left: 1px solid #ccc;
    position: relative;
  }
  .hour-block:first-child {
    border-left: none;
  }

  .activity {
    position: absolute;
    top: 10px;
    background: #0078d4;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    white-space: nowrap;
    box-shadow: 0 4px 8px rgba(0,120,212,0.4);
    user-select: none;
  }
  .activity.mealIncluded {
    background: #28a745; /* vert pour repas inclus */
  }
  #resultats {
    max-width: 700px;
    margin: 1rem auto;
    background: white;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<h1>Planificateur d'activités avec timeline</h1>

<form id="formFiltres">
  <label>
    Ambiance secondaire :
    <select id="selectAmbiance">
      <option value="">-- Toutes --</option>
      <option value="sportif">Sportif</option>
      <option value="gastronomique">Gastronomique</option>
      <option value="chill">Chill</option>
      <option value="romantique">Romantique</option>
      <option value="insolite">Insolite</option>
    </select>
  </label>

  <label>
    Repas inclus obligatoire ?
    <select id="selectRepas">
      <option value="non">Non</option>
      <option value="oui">Oui</option>
    </select>
  </label>

  <label>
    Budget max total (€) :
    <input type="number" id="inputBudget" value="100" min="0" />
  </label>

  <label>
    Heure début (24h) :
    <input type="number" id="inputHeureDebut" value="8" min="0" max="23" />
  </label>

  <label>
    Heure fin (24h) :
    <input type="number" id="inputHeureFin" value="20" min="1" max="24" />
  </label>

  <button type="submit">Planifier</button>
</form>

<div id="timeline-container">
  <div id="timeline"></div>
</div>

<div id="resultats"></div>

<script>
  // Nouvelle liste d'activités
  const activites = [
    {
      id: "rando_esterel",
      title: "Randonnée Estérel avec vue mer",
      phone: "",
      reservationLink: "https://visorando.com/randonnee-esterel",
      address: "Massif de l'Estérel, 83400 Fréjus",
      description: "Explorez les roches rouges de l'Estérel et profitez d'un panorama à couper le souffle sur la Méditerranée.",
      mealIncluded: false,
      duration: 3,
      primaryCategory: "matin",
      secondaryCategory: "sportif",
      budget: 0
    },
    {
      id: "marche_castel",
      title: "Marché du Château et street food niçoise",
      phone: "",
      reservationLink: "https://goo.gl/maps/castel-food",
      address: "Place du Château, 06300 Nice",
      description: "Parcourez les étals colorés du marché et dégustez socca, pissaladière et autres spécialités locales.",
      mealIncluded: true,
      duration: 1,
      primaryCategory: "midi",
      secondaryCategory: "gastronomique",
      budget: 20
    },
    {
      id: "musee_chagall",
      title: "Musée Marc Chagall",
      phone: "+33 4 97 18 53 77",
      reservationLink: "https://musees-nice.org/chagall",
      address: "Avenue Dr Ménard, 06000 Nice",
      description: "Plongez dans l’œuvre biblique et colorée de Chagall, chef‑de‑file de l’art moderne.",
      mealIncluded: false,
      duration: 1.5,
      primaryCategory: "matin",
      secondaryCategory: "chill",
      budget: 12
    },
    {
      id: "cours_cuisine_niçoise",
      title: "Cours de cuisine niçoise",
      phone: "+33 4 93 16 82 40",
      reservationLink: "https://www.latelierpastry.com",
      address: "4 Rue Barillerie, 06300 Nice",
      description: "Apprenez à préparer socca, pissaladière et tourte de blettes avec un chef local.",
      mealIncluded: true,
      duration: 2,
      primaryCategory: "midi",
      secondaryCategory: "gastronomique",
      budget: 35
    },
    {
      id: "canoe_parc_naturel_mercantour",
      title: "Canoë dans le Parc du Mercantour",
      phone: "+33 6 07 03 09 39",
      reservationLink: "https://funbooker.com/canoe-mercantour",
      address: "Lac de Saint-Cassien, 83540 Mons",
      description: "Descendez les eaux turquoise du lac et ses criques sauvages en canoë.",
      mealIncluded: false,
      duration: 3,
      primaryCategory: "après-midi",
      secondaryCategory: "sportif",
      budget: 25
    },
    {
      id: "croisiere_soleil",
      title: "Croisière au coucher du soleil",
      phone: "+33 4 93 85 18 82",
      reservationLink: "https://getyourguide.com/solar-boat-nice",
      address: "Port Lympia, Quai Papacino, 06300 Nice",
      description: "Naviguez à bord d’un bateau solaire et admirez le coucher de soleil sur la Baie des Anges.",
      mealIncluded: false,
      duration: 2,
      primaryCategory: "soir",
      secondaryCategory: "romantique",
      budget: 40
    },
    {
      id: "spectacle_soir",
      title: "Spectacle au théâtre",
      phone: "+33 4 93 82 50 50",
      reservationLink: "https://theatrenice.fr",
      address: "2 Avenue Saint-Jean-Baptiste, 06000 Nice",
      description: "Profitez d’une soirée culturelle avec un spectacle de théâtre local.",
      mealIncluded: false,
      duration: 2,
      primaryCategory: "soir",
      secondaryCategory: "chill",
      budget: 25
    }
  ];

  const form = document.getElementById('formFiltres');
  const timeline = document.getElementById('timeline');
  const resultats = document.getElementById('resultats');

  // Fonction pour créer la timeline des heures
  function creerTimeline(heureDebut, heureFin) {
    timeline.innerHTML = "";
    const heuresCount = heureFin - heureDebut;
    for (let i = 0; i < heuresCount; i++) {
      const heureBloc = document.createElement('div');
      heureBloc.className = 'hour-block';
      heureBloc.style.flex = '1';
      heureBloc.textContent = `${(heureDebut + i).toString().padStart(2, '0')}h`;
      timeline.appendChild(heureBloc);
    }
  }

  // Mappage des catégories horaires en heures sur timeline
  // On fait une plage horaire simple : Matin = 8h-12h, Midi = 12h-14h, Après-midi = 14h-18h, Soir = 18h-22h
  const categorieHorairePlages = {
    matin: { debut: 8, fin: 12 },
    midi: { debut: 12, fin: 14 },
    "après-midi": { debut: 14, fin: 18 },
    soir: { debut: 18, fin: 22 }
  };

  // Fonction pour filtrer selon critères
  function filtrerActivites(ambiance, repasObligatoire, budgetMax) {
    return activites.filter(act => {
      if (ambiance && act.secondaryCategory !== ambiance) return false;
      if (repasObligatoire === "oui" && !act.mealIncluded) return false;
      if (act.budget > budgetMax) return false;
      return true;
    });
  }

  // Fonction pour afficher les activités sur la timeline
  function afficherActivitesSurTimeline(activitesFiltrees, heureDebutGlobal, heureFinGlobal) {
    // On vide d'abord la timeline
    creerTimeline(heureDebutGlobal, heureFinGlobal);

    // Calcul largeur d'un bloc heure pour positionner les activités
    const timelineWidth = timeline.clientWidth || 900; // fallback 900 px
    const totalHeures = heureFinGlobal - heureDebutGlobal;
    const pxParHeure = timelineWidth / totalHeures;

    // Supprimer les anciennes activités (si existantes)
    const anciensElements = timeline.querySelectorAll('.activity');
    anciensElements.forEach(el => el.remove());

    // Pour chaque activité, calculer position selon plage horaire catégorie principale
    activitesFiltrees.forEach(act => {
      const plage = categorieHorairePlages[act.primaryCategory];
      if (!plage) return;

      // Calculer début sur timeline selon heureDebutGlobal
      let debut = Math.max(plage.debut, heureDebutGlobal);
      let fin = Math.min(plage.fin, heureFinGlobal);

      // Durée en heures, limité à plage
      let duree = act.duration;
      if (debut + duree > fin) {
        duree = fin - debut; // coupe durée si dépasse plage ou limite globale
      }
      if (duree <= 0) return;

      // Position et taille en px
      const leftPx = (debut - heureDebutGlobal) * pxParHeure;
      const widthPx = duree * pxParHeure - 4; // 4 px margin interne

      // Création du bloc activité
      const actDiv = document.createElement('div');
      actDiv.className = 'activity' + (act.mealIncluded ? ' mealIncluded' : '');
      actDiv.style.left = `${leftPx}px`;
      actDiv.style.width = `${widthPx}px`;
      actDiv.title = `${act.title}\n${act.description}\nBudget: €${act.budget}\nDurée: ${act.duration}h`;
      actDiv.textContent = act.title;

      timeline.appendChild(actDiv);
    });
  }

  form.addEventListener('submit', e => {
    e.preventDefault();

    const ambiance = document.getElementById('selectAmbiance').value;
    const repasObligatoire = document.getElementById('selectRepas').value;
    const budgetMax = Number(document.getElementById('inputBudget').value);
    const heureDebutGlobal = Number(document.getElementById('inputHeureDebut').value);
    const heureFinGlobal = Number(document.getElementById('inputHeureFin').value);

    if (heureDebutGlobal >= heureFinGlobal) {
      alert("L'heure de début doit être inférieure à l'heure de fin.");
      return;
    }

    const actsFiltres = filtrerActivites(ambiance, repasObligatoire, budgetMax);

    afficherActivitesSurTimeline(actsFiltres, heureDebutGlobal, heureFinGlobal);

    // Afficher le résumé
    let totalBudget = actsFiltres.reduce((sum, a) => sum + a.budget, 0);
    resultats.innerHTML = `
      <h2>Activités filtrées (${actsFiltres.length})</h2>
      <ul>
        ${actsFiltres.map(a => `<li><strong>${a.title}</strong> — Budget: €${a.budget}, Durée: ${a.duration}h, Repas inclus: ${a.mealIncluded ? "Oui" : "Non"}</li>`).join('')}
      </ul>
      <p><strong>Budget total estimé : €${totalBudget}</strong></p>
    `;
  });

  // Initialiser timeline par défaut
  creerTimeline(8, 20);
</script>

</body>
</html>